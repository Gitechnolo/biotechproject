function QRedshift(){if(document.body.classList.contains('qredshift-active'))return;const hour=new Date().getHours();let filter;if(hour>=7&&hour<19){filter='sepia(0.2) hue-rotate(0deg) brightness(1)'}else{filter='sepia(0.5) hue-rotate(-30deg) brightness(1)'}
document.body.classList.add('qredshift-active');document.body.style.filter=filter;document.body.style.transition='filter 0.5s';const menuContainer=document.getElementById('tech-main-menu');if(menuContainer){const menuItem=document.createElement('div');menuItem.className='tech-menu-item';menuItem.setAttribute('data-menu','qredshift');const button=document.createElement('button');button.className='tech-nav-btn';button.type='button';button.setAttribute('aria-haspopup','false');button.setAttribute('aria-expanded','false');button.setAttribute('aria-pressed','true');button.setAttribute('aria-label','Modalit√† comfort visivo attiva: Notte');button.innerHTML='<b>üåô Comfort</b>';menuItem.appendChild(button);menuContainer.appendChild(menuItem);button.addEventListener('click',function(){document.body.classList.remove('qredshift-active');document.body.style.filter='';const particles=document.getElementById('particles-canvas');if(particles)particles.style.display='none';const dna=document.querySelector('.dna-container-8');if(dna)dna.style.display='none';button.setAttribute('aria-pressed','false');button.setAttribute('aria-label','Modalit√† comfort visivo disattivata');button.innerHTML='<b>‚òÄÔ∏è Comfort</b>'})}else{const icon=document.createElement('div');icon.className='qredshift-icon';icon.setAttribute('role','button');icon.setAttribute('tabindex','0');icon.setAttribute('aria-label','Disattiva comfort visivo');icon.title='Comfort visivo QRedshift attivo - clicca per disattivare';icon.style.cssText=`
      position: fixed;
      top: 10px;
      right: 10px;
      width: 36px;
      height: 36px;
      background: rgba(0, 100, 130, 0.8);
      color: #a0e0ff;
      border: 1px solid rgba(100, 200, 255, 0.4);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      z-index: 9999;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      box-shadow: 0 0 10px rgba(100, 200, 255, 0.3);
      font-family: sans-serif;
      transition: all 0.3s ease;
    `;icon.style.willChange='transform, box-shadow';icon.innerHTML='üåô';document.body.appendChild(icon);const disableEffect=()=>{document.body.classList.remove('qredshift-active');document.body.style.filter='';icon.remove()};icon.addEventListener('click',disableEffect);icon.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();disableEffect()}});icon.addEventListener('mouseenter',()=>{icon.style.transform='scale(1.1)';icon.style.boxShadow='0 0 14px rgba(120, 220, 255, 0.5)'});icon.addEventListener('mouseleave',()=>{icon.style.transform='scale(1)';icon.style.boxShadow='0 0 10px rgba(100, 200, 255, 0.3)'});icon.addEventListener('focus',()=>{icon.style.outline='2px solid #66ccff';icon.style.outlineOffset='2px'});icon.addEventListener('blur',()=>{icon.style.outline=''})}}
window.addEventListener('DOMContentLoaded',QRedshift);function fadeEffect(){let text=document.getElementById("fadingText");if(!text)return;let visible=!0;setInterval(()=>{visible=!visible;text.classList.toggle("fade",!visible)},2000)}
window.addEventListener("load",fadeEffect);var inmenu=!1;var lastmenu=0;function Menu(current){if(!document.getElementById)return;inmenu=!0;var oldmenu=lastmenu;lastmenu=current;if(oldmenu)Erase(oldmenu);var m=document.getElementById("menu-"+current);var box=document.getElementById(current);if(!m||!box)return;var table=document.querySelector('table.menu');if(!table){box.style.left=m.offsetLeft+'px'}else{var tableRect=table.getBoundingClientRect();var boxWidth=553;var leftOffset=tableRect.left+(tableRect.width/2)-(boxWidth/2);box.style.left=leftOffset+'px'}
box.style.top=(table?table.offsetTop+table.offsetHeight:m.offsetTop+m.offsetHeight)+'px';box.style.visibility="visible";m.style.backgroundColor="rgba(209, 206, 206, 0.57)";box.style.backgroundColor="rgba(209, 206, 206, 0.57)";box.style.width="553px"}
function Erase(current){if(!document.getElementById)return;if(inmenu&&lastmenu===current)return;var m=document.getElementById("menu-"+current);var box=document.getElementById(current);if(!m||!box)return;box.style.visibility="hidden";m.style.backgroundColor="Silver"}
function Timeout(current){inmenu=!1;window.setTimeout(()=>Erase(current),500)}
function Highlight(menu,item){if(!document.getElementById)return;inmenu=!0;lastmenu=menu;var obj=document.getElementById(item);if(obj)obj.style.backgroundColor="Silver"}
function UnHighlight(menu,item){if(!document.getElementById)return;Timeout(menu);var obj=document.getElementById(item);if(obj)obj.style.backgroundColor="rgba(209, 206, 206, 0.57)"}
function Clock(){if(window.__clockLegacyRunning)return;window.__clockLegacyRunning=!0;const el=document.getElementById("clock");if(!el)return;function update(){const d=new Date();const pad=n=>n<10?'0'+n:n;const day=pad(d.getDate());const month=pad(d.getMonth()+1);const year=d.getFullYear();const hours=pad(d.getHours());const mins=pad(d.getMinutes());const secs=pad(d.getSeconds());el.textContent=`${day}/${month}/${year} - ${hours}:${mins}:${secs}`}
update();setInterval(update,1000)}
function startModernClock(){const el=document.getElementById("clock2");if(!el)return;function pad(n){return n<10?'0'+n:n}
function update(){const now=new Date();const day=pad(now.getDate());const month=pad(now.getMonth()+1);const year=now.getFullYear();const hours=pad(now.getHours());const mins=pad(now.getMinutes());const secs=pad(now.getSeconds());el.textContent=`${day}/${month}/${year} - ${hours}:${mins}:${secs}`}
update();const intervalId=setInterval(update,1000);return()=>clearInterval(intervalId)}
const countdownEl=document.getElementById('modern-countdown');const daysSpan=countdownEl?.querySelector('#countdown-days');if(countdownEl&&daysSpan){function updateCountdown(){const now=new Date();const currentYear=now.getFullYear();const nextYear=currentYear+1;const newYear=new Date(`January 1, ${nextYear} 00:00:00`);const diff=newYear-now;const days=Math.floor(diff/(1000*60*60*24));daysSpan.textContent=days}
updateCountdown();setInterval(updateCountdown,3600000)}
function openModal(){document.getElementById("myModal").style.display="block"}
function closeModal(){document.getElementById("myModal").style.display="none"}
var slideIndex=1;showSlides(slideIndex);function plusSlides(n){showSlides(slideIndex+=n)}
function currentSlide(n){showSlides(slideIndex=n)}
function showSlides(n){var i;var slides=document.getElementsByClassName("mySlides");var dots=document.getElementsByClassName("demo");var captionText=document.getElementById("caption");if(slides.length===0){return}
if(n>slides.length){slideIndex=1}else if(n<1){slideIndex=slides.length}else{slideIndex=n}
for(i=0;i<slides.length;i++){slides[i].style.display="none"}
for(i=0;i<dots.length;i++){dots[i].className=dots[i].className.replace(" active","")}
slides[slideIndex-1].style.display="block";if(dots.length>0&&dots[slideIndex-1]){dots[slideIndex-1].className+=" active";if(captionText){captionText.innerHTML=dots[slideIndex-1].alt||""}}}
function throttle(fn,limit){let inThrottle;return function(...args){if(!inThrottle){fn.apply(this,args);inThrottle=!0;setTimeout(()=>inThrottle=!1,limit)}}}
function debounce(fn,delay){let timer;return function(...args){clearTimeout(timer);timer=setTimeout(()=>fn.apply(this,args),delay)}}
function initLazyLoading(){if(!('IntersectionObserver' in window)){document.querySelectorAll('img[data-src]').forEach(img=>{img.src=img.dataset.src});return}
const observer=new IntersectionObserver((entries,obs)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;img.src=img.dataset.src;img.removeAttribute('data-src');obs.unobserve(img)}})},{threshold:0.05});document.querySelectorAll('img[data-src]').forEach(img=>{observer.observe(img)});return observer}
const lazyImageObserver=initLazyLoading();function loadScript(src,callback){if(document.querySelector(`script[src="${src}"]`)){if(callback)callback();return}
const script=document.createElement('script');script.src=src;script.async=!0;script.onload=()=>callback?.();script.onerror=()=>{console.error(`Errore nel caricamento dello script: ${src}`)};document.head.appendChild(script)}
function infoFunction(){var popup=document.getElementById("myPopup");popup.classList.toggle("show")}
function turnOnLight(){const img=document.getElementById('myImage');img.src='https://gitechnolo.github.io/biotechproject/Biotech-file/images/pic_bulbon.avif';img.classList.add('bulb-glow')}
function turnOffLight(){const img=document.getElementById('myImage');img.src='https://gitechnolo.github.io/biotechproject/Biotech-file/images/pic_bulboff.avif';img.classList.remove('bulb-glow')}(function(){if(!document.body.hasAttribute('data-modern-menu'))return;document.addEventListener('DOMContentLoaded',function(){let openDropdown=null;document.querySelectorAll('.tech-nav-btn').forEach(btn=>{const dropdown=btn.nextElementSibling;if(!dropdown||!dropdown.classList.contains('tech-dropdown')){console.warn('Dropdown non trovato o classe errata per:',btn);return}
btn.setAttribute('aria-haspopup','true');btn.setAttribute('aria-expanded','false');btn.addEventListener('click',e=>{e.stopPropagation();const isExpanded=btn.getAttribute('aria-expanded')==='true';if(openDropdown&&openDropdown!==dropdown){openDropdown.classList.remove('show');const prevBtn=openDropdown.previousElementSibling?.querySelector('.tech-nav-btn');prevBtn?.setAttribute('aria-expanded','false')}
if(isExpanded){dropdown.classList.remove('show');btn.setAttribute('aria-expanded','false');openDropdown=null}else{dropdown.classList.add('show');btn.setAttribute('aria-expanded','true');openDropdown=dropdown;console.log('Menu aperto, openDropdown =',dropdown.id||'senza id')}});btn.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();const isExpanded=btn.getAttribute('aria-expanded')==='true';btn.click();if(!isExpanded){setTimeout(()=>{const firstItem=dropdown.querySelector('[role="menuitem"]');if(firstItem)firstItem.focus();},100)}}});dropdown.addEventListener('keydown',function(e){const items=Array.from(dropdown.querySelectorAll('[role="menuitem"]:not([disabled])'));const currentIndex=items.indexOf(document.activeElement);if(e.key==='ArrowDown'){e.preventDefault();const nextIndex=(currentIndex+1)%items.length;items[nextIndex]?.focus()}else if(e.key==='ArrowUp'){e.preventDefault();const prevIndex=(currentIndex-1+items.length)%items.length;items[prevIndex]?.focus()}else if(e.key==='Home'){e.preventDefault();items[0]?.focus()}else if(e.key==='End'){e.preventDefault();items[items.length-1]?.focus()}else if(e.key==='Escape'){e.stopPropagation();dropdown.classList.remove('show');btn.setAttribute('aria-expanded','false');btn.focus();openDropdown=null}})});document.addEventListener('click',(e)=>{const isClickInside=e.target.closest('.tech-menu-item')||e.target.closest('.tech-dropdown');if(!isClickInside&&openDropdown){console.log('Click fuori ‚Üí chiusura menu');openDropdown.classList.remove('show');const btn=openDropdown.previousElementSibling?.querySelector('.tech-nav-btn');btn?.setAttribute('aria-expanded','false');btn?.focus();openDropdown=null}});document.addEventListener('keydown',e=>{console.log('Tasto premuto:',e.key,'openDropdown attuale:',openDropdown);if(e.key==='Escape'&&openDropdown){console.log('Esc premuto: chiusura menu');openDropdown.classList.remove('show');const btn=openDropdown.previousElementSibling?.querySelector('.tech-nav-btn');btn?.setAttribute('aria-expanded','false');btn?.focus();openDropdown=null}else if(e.key==='Escape'){console.log('Esc premuto, ma openDropdown √®',openDropdown)}})})})();function PopupCentrata(){var w=760;var h=370;var l=Math.floor((screen.width-w)/2);var t=Math.floor((screen.height-h)/2);window.open("https://gitechnolo.github.io/biotechproject/O.S_support.html","","width="+w+",height="+h+",top="+t+",left="+l)}
function ChatGPTpopupCenterAI(){var w=825;var h=672;var l=Math.floor((screen.width-w)/2);var t=Math.floor((screen.height-h)/2);window.open("https://gitechnolo.github.io/biotechproject/Tablet_forum.html","","width="+w+",height="+h+",top="+t+",left="+l)}
function openPopup(url,title,width,height){const left=Math.floor((screen.width-width)/2);const top=Math.floor((screen.height-height)/2);const options=`
    width=${width},
    height=${height},
    top=${top},
    left=${left},
    resizable=yes,
    scrollbars=yes,
    toolbar=no,
    menubar=no,
    location=no
  `;const popup=window.open(url,title,options);if(!popup||popup.closed||typeof popup.closed=='undefined'){alert("Il popup √® stato bloccato. Per favore, abilita i popup per questo sito.");return}
popup.focus()}
function openSupportPopup(){openPopup('https://gitechnolo.github.io/biotechproject/O.S_support.html','O.S. Support Chat GPT',760,440)}
function openContactPopup(){openPopup('https://gitechnolo.github.io/biotechproject/Tablet_forum.html','Contattaci - Forum ChatGPT',825,672)}
document.addEventListener("DOMContentLoaded",function(){if(!document.body.hasAttribute('data-modern-menu'))return;const toggleBtn=document.getElementById("keyboard-nav-toggle");const body=document.body;let keyboardNavActive=!1;function toggleKeyboardNavigation(){keyboardNavActive=!keyboardNavActive;if(keyboardNavActive){body.classList.add("keyboard-navigation-on");toggleBtn?.setAttribute("aria-pressed","true");toggleBtn?.setAttribute("data-active","true");toggleBtn.textContent="‚úÖ Navigazione Attiva"}else{body.classList.remove("keyboard-navigation-on");toggleBtn?.setAttribute("aria-pressed","false");toggleBtn?.setAttribute("data-active","false");toggleBtn.textContent="üîß Navigazione Tastiera"}}
toggleBtn?.addEventListener("click",toggleKeyboardNavigation);document.addEventListener("keydown",function(e){if(e.key==="Tab"){if(!keyboardNavActive){toggleKeyboardNavigation()}}});setTimeout(()=>{toggleBtn?.classList.remove("hint")},2500)});function initThemeToggle(){const themeBtn=document.getElementById('theme-toggle');if(!themeBtn)return;const themes=[{name:'Verde',rgb:'0, 230, 118',h:143,s:'100%',l:'45%'},{name:'Ciano',rgb:'0, 200, 255',h:190,s:'100%',l:'50%'},{name:'Viola',rgb:'138, 43, 226',h:270,s:'75%',l:'53%'},{name:'Arancione',rgb:'255, 140, 0',h:39,s:'100%',l:'50%'},{name:'Blu Profondo',rgb:'0, 120, 255',h:210,s:'100%',l:'50%'}];let currentThemeIndex=0;if(window.matchMedia('(prefers-contrast: high)').matches){currentThemeIndex=themes.findIndex(t=>t.name==='Blu Profondo')||0}
const savedTheme=localStorage.getItem('biotech-theme');if(savedTheme!==null){const index=parseInt(savedTheme,10);if(index>=0&&index<themes.length){currentThemeIndex=index}}
function updateAriaLabel(themeName){themeBtn.setAttribute('aria-label',`Cambia tema colore: attualmente ${themeName}, clicca per passare al successivo`)}
function applyTheme(index){const theme=themes[index];document.documentElement.style.setProperty('--color-accent-rgb',theme.rgb);document.documentElement.style.setProperty('--color-accent-h',theme.h);document.documentElement.style.setProperty('--color-accent-s',theme.s);document.documentElement.style.setProperty('--color-accent-l',theme.l);document.documentElement.style.setProperty('--color-glow',`hsl(${theme.h}, 100%, 70%)`);themeBtn.textContent=`üé® Tema: (${theme.name})`;updateAriaLabel(theme.name)}
applyTheme(currentThemeIndex);themeBtn.addEventListener('click',(e)=>{e.preventDefault();currentThemeIndex=(currentThemeIndex+1)%themes.length;applyTheme(currentThemeIndex);localStorage.setItem('biotech-theme',currentThemeIndex)})}
window.addEventListener('DOMContentLoaded',initThemeToggle);function handleVideoPosterKey(event){if(event.key==='Enter'||event.key===' '){event.preventDefault();loadAndPlayVideo()}}
document.addEventListener('DOMContentLoaded',()=>{const el=document.getElementById('lastModified');if(el){const d=new Date(document.lastModified);const options={day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'};el.textContent=`Last edit: ${d.toLocaleDateString('it-IT', options)}`}});function speakTerm(term,language='italiano'){if(speechSynthesis.speaking){speechSynthesis.cancel()}
const customPronunciations={'CRISPR':'Clustered Regularly Interspaced Short Palindromic Repeats','mitocondri':'Mi-to-con-dri','lisosoma':'Li-so-so-ma','miochine':'Mi-o-ki-ne','sinaptogenesi':'Si-na-to-jen-e-si','epigenetici':'E-pi-je-ne-ti-ci','ATP':'Adenosina trifosfato','DNA':'Acido desossiribonucleico','RNA':'Acido ribonucleico','tegumento':'Te-gu-men-to','Pecquet':'Pes-ch√©'};const langMap={'italiano':'it-IT','inglese':'en-US'};const utteranceText=customPronunciations[term.toLowerCase()]||term;const utterance=new SpeechSynthesisUtterance(utteranceText);utterance.lang=langMap[language]||'it-IT';utterance.rate=0.8;utterance.pitch=1.0;utterance.volume=1.0;const announcement=document.getElementById('sr-announcement');if(announcement){announcement.textContent=`Lettura avviata: ${term}.`;setTimeout(()=>{if(announcement.textContent.includes(term)){announcement.textContent=''}},1000)}
console.log(`üîä Pronuncia attivata: "${term}" come "${utteranceText}" (${utterance.lang})`);speechSynthesis.speak(utterance)}
function handlePronounceKey(event,term,language='italiano'){if(event.key==='Enter'||event.key===' '){event.preventDefault();speakTerm(term,language)}}
let currentLang='it';const translatablePages=['index','Progetti','Staff','Marketing','Tech_Maturity','Dermatologia','Cuore','Cellula','Apparato_digerente','Apparato_respiratorio','Apparato_tegumentario','Sistema_linfatico','Specials'];function getPageKey(pageName){const map={'index':'home','Tech_Maturity':'tech_maturity','Apparato_digerente':'apparato_digerente','Apparato_respiratorio':'apparato_respiratorio','Apparato_tegumentario':'apparato_tegumentario','Sistema_linfatico':'sistema_linfatico'};return map[pageName]||pageName.toLowerCase()}
function getPageName(){const path=window.location.pathname;const fileName=path.split('/').pop().replace('.html','');return fileName.replace('-semplice','')}
async function loadTranslation(path){try{const res=await fetch(path);if(!res.ok)throw new Error(`File non trovato: ${path}`);return await res.json()}catch(err){console.warn(err);return null}}
function applyTranslations(translations,lang){document.querySelectorAll('[data-lang-key]').forEach(el=>{const key=el.getAttribute('data-lang-key');const value=translations[lang]?.[key];if(value!==undefined&&value!==null){if(el.tagName==='INPUT'||el.tagName==='TEXTAREA'){el.setAttribute('placeholder',value)}else if(el.tagName==='IMG'){el.setAttribute('alt',value)}else if(el.hasAttribute('aria-label')){el.setAttribute('aria-label',value);const bold=el.querySelector('b');if(bold){bold.textContent=value}else{el.innerHTML=value}}else{const bold=el.querySelector('b');if(bold){bold.textContent=value}else{el.innerHTML=value}}}});console.log(`‚úÖ Traduzioni applicate in ${lang}`)}
async function initTranslations(){setTimeout(async()=>{const pageName=getPageName();const savedLang=getSavedLanguage();if(!translatablePages.includes(pageName)){const common=await loadTranslation('lang/common.json');const translations={it:{...(common?.it||{})},en:{...(common?.en||{})}};applyTranslations(translations,savedLang);updateLanguageButton(savedLang);document.documentElement.lang=savedLang;const button=document.getElementById('lang-toggle');if(button){button.addEventListener('click',()=>{const newLang=savedLang==='it'?'en':'it';localStorage.setItem('preferred-language',newLang);window.location.reload()})}
return}
const translations={it:{},en:{}};const common=await loadTranslation('lang/common.json');if(common){translations.it={...common.it};translations.en={...common.en}}
const pageKey=getPageKey(pageName);const pageData=await loadTranslation(`lang/${pageKey}.json`);if(pageData){if(pageData.it)translations.it={...translations.it,...pageData.it};if(pageData.en)translations.en={...translations.en,...pageData.en}}
applyTranslations(translations,savedLang);updateLanguageButton(savedLang);document.documentElement.lang=savedLang;currentLang=savedLang},150)}
function getSavedLanguage(){return localStorage.getItem('preferred-language')||(navigator.language.startsWith('en')?'en':'it')}
function updateLanguageButton(lang){const flag=document.getElementById('lang-flag');const text=document.getElementById('lang-text');const button=document.getElementById('lang-toggle');const label=document.getElementById('lang-label');if(!flag||!button)return;if(lang==='it'){flag.textContent='üá¨üáß';if(text)text.textContent='English';if(label)label.textContent='Switch language';button.setAttribute('aria-label','Switch to English')}else{flag.textContent='üáÆüáπ';if(text)text.textContent='Italiano';if(label)label.textContent='Cambia lingua';button.setAttribute('aria-label','Cambia lingua in italiano')}}
function setLanguage(lang){const pageName=getPageName();if(!translatablePages.includes(pageName)){loadTranslation('lang/common.json').then(common=>{if(!common)return;const translations={it:common.it||{},en:common.en||{}};setTimeout(()=>{applyTranslations(translations,lang);updateLanguageButton(lang);document.documentElement.lang=lang;currentLang=lang;localStorage.setItem('preferred-language',lang)},100)});return}
const pageKey=getPageKey(pageName);const commonPromise=loadTranslation('lang/common.json');const pagePromise=loadTranslation(`lang/${pageKey}.json`);Promise.all([commonPromise,pagePromise]).then(([common,pageData])=>{const translations={it:{},en:{}};if(common){translations.it={...common.it};translations.en={...common.en}}
if(pageData){if(pageData.it)translations.it={...translations.it,...pageData.it};if(pageData.en)translations.en={...translations.en,...pageData.en}}
setTimeout(()=>{applyTranslations(translations,lang);updateLanguageButton(lang);document.documentElement.lang=lang;currentLang=lang;localStorage.setItem('preferred-language',lang)},100)})}
function toggleLanguage(){const newLang=currentLang==='it'?'en':'it';setLanguage(newLang)}
document.addEventListener('DOMContentLoaded',()=>{initTranslations().catch(err=>{console.error('Errore nel caricamento delle traduzioni:',err)});window.toggleLanguage=toggleLanguage})